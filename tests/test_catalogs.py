import pytest
from jubapi.server import app
from fastapi.testclient import TestClient
from jubapi.models import Catalog,CatalogKind,CatalogItem

client = TestClient(app)

@pytest.mark.asyncio
async def test_api_create_catalog():
    # Create a new catalog DTO
    catalog = Catalog(
        cid="apicatalogcid",
        display_name="TEST CATALOG",
        kind=CatalogKind.INTEREST,
        items=[
            CatalogItem(
                value="A",
                display_name="Display Value (A)",
                code=0,
                description="Item A",
                metadata={"extra_info": "Some extra info for A"}

            ),
        ]
    )
    response = client.post("/v1/catalogs", json=catalog.model_dump())
    
    print(response.json())
    assert response.status_code == 200, "API request failed"